<VirtualHost *:80>
  ServerAdmin {{ email}}
  ServerName {{ url }}
  ServerAlias {{ alias_urls }}

  RewriteEngine On
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>
<IfModule mod_ssl.c>
  <VirtualHost _default_:443>
    ServerAdmin {{ email }}
    ServerName {{ url }}
    ServerAlias {{ alias_urls }}

    DocumentRoot {{ srv_dir }}

    SSLEngine On
    SSLCertificateFile /etc/apache2/ssl/apache.crt
    SSLCertificateKeyFile /etc/apache2/ssl/apache.key
    SSLCertificateChainFile /etc/apache2/ssl/apache.ca-bundle

    ErrorLog "/var/log/apache2/helium_error.log"
    CustomLog "/var/log/apache2/helium_access.log" combined

    # Serve Django application
    WSGIDaemonProcess {{ ansible_user }} python-path={{ srv_dir }}:/usr/local/lib/python2.7/dist-packages
    WSGIProcessGroup {{ ansible_user }}
    WSGIPassAuthorization On

    WSGIScriptAlias / {{ srv_dir }}/conf/wsgi.py

    <Directory {{ srv_dir }}/conf>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>

    {% if serve_local %}
    # Service static and media files locally
    Alias /media/ {{ srv_dir }}/media/
    Alias /static/ {{ srv_dir }}/static/

    <Directory {{ srv_dir }}/static>
        Require all granted
    </Directory>

    <Directory {{ srv_dir }}/media>
        Require all granted
    </Directory>
    {% endif %}
  </VirtualHost>
</IfModule>
